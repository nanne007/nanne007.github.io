<!DOCTYPE html>
<html lang="en-us">

<head>
  
    <title>Paper: A critique of ANSI SQL isolation levels 笔记 | Give me five</title>
    <meta name="DC.Title" content="Paper: A critique of ANSI SQL isolation levels 笔记">
  

  
    <meta name="DC.Date" content="2018/09/10">
  

  
    <meta name="DC.Creator" content="Jiafeng Cao">
  

  
    <meta name="DC.Language" content="en">
  

  
    <meta name="DC.Description" content="P1(Dirty Read): 脏读 w1[x] ... r2[x] ...   txn1 修改了一行数据。（未 commit 之前） txn2 读到修改的值。（未commit 之前）  P2(Fuzz or Non-repeatable Read): 不可重读 r1[x] ... w2[x] ... c2 ... r1[x] ... c1   txn1 读了一个数据， txn2 修改这个数据，并 commit txn1 重新读这个数据，读到新的值。  P3(Phantom): 幻读 r1[P] ... w2[y in P] ... c2 ... r1[P] ... c1   txn1 读了一段满足某个 condition 的数据， txn2 修改了一条数据，使之满足或者不满足这个 condition（比如说删掉了一条满足 condition 的数据，新增了一条满足 condition 数据），并 commit。 txn1 重新读满足这个 condition 的数据，返回数据变化。  P2 可以看做是 P3 的特殊 case。">
  

  
    <meta name="DC.Identifier" content="/notes/about_isolation/">
  

  
    <meta name="keywords" content="database,isolation-level,">
  

  

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../../css/style.css" />
  <link rel="stylesheet" href="../../css/fonts.css" />
</head>

    <a class="skip-main" href="#main">Skip to main content</a>
        <nav>
      <h1> Give me five </h1>
      <div>
      
      
      
      
        <a href="../../" title="Home">home</a>
      
      
        <a href="../../posts/" title="Posts">posts</a>
      
      
        <a href="../../notes/" title="Notes">notes</a>
      

      
      
        <a href="../../index.xml" title="RSS">rss</a>
      
      </div>
    </ul>
  </nav>




<main id="main">
<header>
    
        <h1>Paper: A critique of ANSI SQL isolation levels 笔记</h1>
    

    
        
            Jiafeng Cao
        
         2018/09/10 
    

    
</header>

<article>


<h3 id="p1-dirty-read-脏读">P1(Dirty Read): 脏读</h3>

<pre><code>w1[x] ... r2[x] ...
</code></pre>

<ul>
<li>txn1 修改了一行数据。（未 commit 之前）</li>
<li>txn2 读到修改的值。（未commit 之前）</li>
</ul>

<h3 id="p2-fuzz-or-non-repeatable-read-不可重读">P2(Fuzz or Non-repeatable Read): 不可重读</h3>

<pre><code>r1[x] ... w2[x] ... c2 ... r1[x] ... c1
</code></pre>

<ul>
<li>txn1 读了一个数据，</li>
<li>txn2 修改这个数据，并 commit</li>
<li>txn1 重新读这个数据，读到新的值。</li>
</ul>

<h3 id="p3-phantom-幻读">P3(Phantom): 幻读</h3>

<pre><code>r1[P] ... w2[y in P] ... c2 ... r1[P] ... c1
</code></pre>

<ul>
<li>txn1 读了一段满足某个 condition 的数据，</li>
<li>txn2 修改了一条数据，使之满足或者不满足这个 condition（比如说删掉了一条满足 condition 的数据，新增了一条满足 condition 数据），并 commit。</li>
<li>txn1 重新读满足这个 condition 的数据，返回数据变化。</li>
</ul>

<p>P2 可以看做是 P3 的特殊 case。</p>

<h3 id="p0-dirty-write-脏写">P0(Dirty Write): 脏写</h3>

<pre><code>w1[x] ... w2[x] ... ((c1 or a1) and (c2 or a2) in any order)
</code></pre>

<ul>
<li>txn1 修改了一条数据。</li>
<li>txn2 再次修改同一条数据。</li>
</ul>

<p>txn2 应该 abort 或者 等待 txn1 结束。否则会破坏数据约束。</p>

<p>比如： <code>w1[x = 10] w2[x = 20] w2[y = 20] c2 w1[y = 10] c1</code> 会违背 x = y 这个约束。</p>

<p>论文给出：</p>

<table>
<thead>
<tr>
<th align="center">Isolation Level</th>
<th align="center">P0: Dirty Write</th>
<th align="center">P1: Dirty Read</th>
<th align="center">P2: Fuzzy Read</th>
<th align="center">P3: Phantom</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">READ UNCOMMITTED</td>
<td align="center">Not Possible</td>
<td align="center">Possible</td>
<td align="center">Possible</td>
<td align="center">Possible</td>
</tr>

<tr>
<td align="center">READ COMMITTED</td>
<td align="center">Not Possible</td>
<td align="center">Not Possible</td>
<td align="center">Possible</td>
<td align="center">Possible</td>
</tr>

<tr>
<td align="center">REPEATABLE READ</td>
<td align="center">Not Possible</td>
<td align="center">Not Possible</td>
<td align="center">Not Possible</td>
<td align="center">Possible</td>
</tr>

<tr>
<td align="center">SERIALIZABLE</td>
<td align="center">Not Possible</td>
<td align="center">Not Possible</td>
<td align="center">Not Possible</td>
<td align="center">Not Possible</td>
</tr>
</tbody>
</table>

<p>但是还有其他的 anomaly !!!</p>

<h3 id="p4-lost-update">P4(Lost Update):</h3>

<pre><code>r1[x] ... r2[x] ... w2[x] ... w1[x] ... c1 ... c2
</code></pre>

<ul>
<li>txn1 读了一条数据。</li>
<li>txn2 读了并修改了这条数据。</li>
<li>txn1 修改这条数据，然后 commit。</li>
<li>txn2 commit。</li>
</ul>

<p>txn1 做的修改不见了。</p>

<h3 id="a5a-read-skew-读偏斜">A5A(Read Skew): 读偏斜</h3>

<pre><code>r1[x]...w2[x]...w2[y]...c2...r1[y]...(c1 or a1)
</code></pre>

<ul>
<li>txn1 读了 x。</li>
<li>txn2 写了 x 和 y，然后 commit。</li>
<li>txn1 再读 y，读到新值。</li>
</ul>

<p>txn 读到的 x，y 不满足某个约束（比如 x==y）。</p>

<h3 id="a5b-write-skew-写偏斜">A5B(Write Skew): 写偏斜</h3>

<pre><code>r1[x]...r2[y]...w1[y] ...w2[x]...(c1 and c2)
</code></pre>

<ul>
<li>txn1 读了x。</li>
<li>txn2 读了 y。</li>
<li>txn1 写了 y。</li>
<li>txn2 写了 x。</li>
<li>两个 txn 做 commit。</li>
</ul>

<p>最后 x，y 可能不满足某个约束。比如（x+y=2）</p>

</article>
</main>

    <footer>
    <hr>
      
  <link rel="stylesheet" href="../../css/vs.min.css">
  <script src="../../js/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  <script>
    
    let elements = document.getElementsByClassName("highlight");
    for (let element_id = 0; element_id < elements.length; element_id++) {
      const element = elements[element_id];
      
      element.firstChild.setAttribute("style", "");
      
      let language = element.firstChild.firstChild.getAttribute("data-lang");
      if (language !== null) {
          element.firstChild.firstChild.setAttribute("class", language);
      }
    }
  </script>

  <script>
    const code = document.querySelectorAll("code");
    [...code].forEach(el => el.textContent = el.textContent.replace(/^\n/,''));
  </script>

      <p>
        Last updated Dec 08 2020
      </p>
      <p>
        
      </p>
      <br>
    </footer>
  </body>
</html>

